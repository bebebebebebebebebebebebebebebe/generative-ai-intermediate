---
marp: true
theme: default
paginate: true
backgroundColor: #fff
style: |
  section {
    font-size: 28px;
  }
  h1 {
    color: #2563eb;
    font-size: 48px;
  }
  h2 {
    color: #1e40af;
    font-size: 40px;
  }
  h3 {
    color: #1e3a8a;
    font-size: 32px;
  }
  code {
    background: #f1f5f9;
    padding: 2px 6px;
    border-radius: 4px;
  }
  table {
    font-size: 24px;
  }
---

<!-- _class: lead -->
<!-- _paginate: false -->

# 第2回：LLMノードとプロンプト設計

---

## この回で学ぶこと

- LLMノードの基本的な使い方
- 効果的なプロンプトの書き方
- 変数を使った動的なプロンプト作成
- 実際に動くAIアプリケーションの作成

**前提知識：** プログラミングの知識は不要です
Difyの画面操作のみで学習できます

---

## 目次

1. LLMノードとは
2. LLMノードの追加と設定
3. プロンプトの書き方
4. 変数を使ったプロンプト
5. 実践：AIアシスタントを作る
6. 構造化出力（Structured Output）

---

<!-- _class: lead -->

# 1. LLMノードとは

---

## LLMノードの役割

**LLMノード**は、ChatGPTやClaudeなどの
AIモデルと会話するための部品です。

```
[ユーザーの質問] → [LLMノード] → [AIの回答]
```

---

## できること

- 質問に答える
- 文章を要約する
- 翻訳する
- アイデアを出す
- 文章を添削する
- など、さまざまなタスク

---

## ストリーミングとブロッキング

LLMノードには2つの動作モードがあります
基本的には**ストリーミング**がおすすめです

---

### ストリーミングモード（推奨）

AIが考えながら、一文字ずつリアルタイムに表示

```
「こんに」「ちは」「、」「今日」「は」...
```

**メリット：** 待ち時間が短く感じられ、
ChatGPTのようなスムーズな体験

---

### ブロッキングモード

AIが回答をすべて作り終えてから、一度に表示

```
（考え中...）
↓
「こんにちは、今日はいい天気ですね」
```

**メリット：** 他のシステムと連携する場合に便利

---

<!-- _class: lead -->

# 2. LLMノードの追加と設定

---

## ステップ1: アプリケーションを作成

1. Difyにログイン
2. 左メニューから「スタジオ」をクリック
3. 「空白のワークフローから作成」を選択
4. アプリ名を入力（例：「はじめてのLLM」）

**注意：** 「チャットボット」を選ぶと画面構成が異なります

---

## ステップ2: LLMノードを追加

1. 「開始」ノードの右側の「＋」をクリック
2. ノード一覧から「LLM」を選択
3. LLMノードが追加され、線でつながります

---

## ステップ3: モデルを選択

**モデルの選択：**
- **Gemini**：Googleのモデル

**初心者におすすめ：**
まずは「gemini-2.5-flash」から始めましょう

---

## パラメータ設定

LLMノードの右側パネルで設定できます

主なパラメータ：
- **ストリーミング出力**
- **Temperature（温度）**
- **Maximum Tokens（最大トークン数）**
- **Response Format（応答形式）**

---

### Temperature（温度）

AIの「創造性」を調整します

| 設定値 | 動作 | 使いどころ |
|--------|------|-----------|
| 0.0 | 毎回同じ答え | 計算問題、正確な情報 |
| 0.5 | バランス | 一般的なQ&A |
| 0.9 | 創造的な答え | 物語作成、アイデア出し |

---

### Temperature の例

**質問：** 「1+1は？」

- Temperature 0.0 → 毎回「2です」
- Temperature 0.9 → 「2です」「二つです」「2ですね」など変化

---

### Maximum Tokens（最大トークン数）

AIが生成する文章の長さの上限

| 設定値 | 目安 |
|--------|------|
| 512 | 短い回答（数行〜1段落） |
| 1024 | 標準的な回答（400〜800文字） |
| 2048 | 長文の生成（ブログ記事など） |
| 4096+ | 非常に長いレポートや詳細な解説 |

**注意：** トークン数が多いほど、時間とコストがかかる

---

<!-- _class: lead -->

# 3. プロンプトの書き方

---

## プロンプトとは

AIに対する「指示文」のことです

プロンプトの良し悪しで、
AIの回答の質が大きく変わります

---

## 基本的なプロンプトの構成

```
[役割] + [タスク] + [制約条件] + [出力形式]
```

---

## 例1: シンプルなプロンプト

**悪い例：**
```
説明して
```
→ 何を説明するのか不明確

**良い例：**
```
あなたは親切な先生です。
プロンプトエンジニアリングについて、
小学生にもわかるように説明してください。
```
→ 役割とタスクが明確

---

## 例2: 詳細なプロンプト

```
【役割】
あなたは経験豊富なカスタマーサポート担当者です。

【タスク】
顧客からの問い合わせに対して、
丁寧で分かりやすい回答を作成してください。

【制約条件】
- 敬語を使用すること
- 回答は300文字以内
- 専門用語は避けること
- 必要に応じて具体例を示すこと
```

---

## 💡 プロのテクニック

自分でゼロからプロンプトを書くのが難しい場合は、
Difyの**自動生成機能**を使いましょう

1. プロンプト入力欄の右上「✨」をクリック
2. やりたいことを一言入力
3. 「生成」ボタンを押す
4. AIが詳細なプロンプトを自動生成

---

## プロンプトのテクニック

1. **Few-shot（例示）**
   - AIに「お手本」を見せる

2. **ステップバイステップ**
   - 複雑なタスクを段階的に実行

3. **ペルソナ設定**
   - AIに具体的な役割を与える

---

### テクニック1: Few-shot（例示）

```
以下の例を参考に、商品レビューを分類してください。

【例1】
レビュー：「とても良い商品でした！」
分類：ポジティブ

【例2】
レビュー：「期待外れでした」
分類：ネガティブ

【分類してください】
レビュー：「普通です」
分類：
```

---

### テクニック2: ステップバイステップ

```
以下の手順で文章を要約してください：

ステップ1：文章の主題を特定する
ステップ2：重要なポイントを3つ抜き出す
ステップ3：各ポイントを1文にまとめる
ステップ4：3つの文を組み合わせて要約を作る

文章：
{ここにユーザーの文章が入る}
```

---

### テクニック3: ペルソナ設定

```
あなたは以下の設定のキャラクターです：
- 名前：さくらAI
- 性格：明るく親しみやすい
- 口調：「です・ます」調
- 特徴：絵文字を適度に使う（多用しない）

この設定で、ユーザーの質問に答えてください。
```

---

<!-- _class: lead -->

# 4. 変数を使ったプロンプト

---

## 変数とは

**変数**は、ユーザーの入力や他のノードの結果を
受け取る「箱」のようなもの

同じプロンプトでも、
毎回違う内容に対応できます

---

## 変数の例

```
変数なし：「天気について教えて」
→ 毎回「天気」についてしか答えない

変数あり：「{{topic}}について教えて」
→ 箱(topic)に「料理」を入れると...
   「料理について教えて」になる
→ 箱(topic)に「歴史」を入れると...
   「歴史について教えて」になる
```

---

## 開始ブロック（開始ノード）

ワークフローの入り口となる特別なノード

```
[ユーザー] → 入力 → [開始ブロック] 
  → 変数として保存 → [LLMノードなどで使用]
```

---

## 開始ブロックで設定できる項目

| 項目 | 説明 | 例 |
|------|------|-----|
| フィールド名 | 変数の名前 | `user_question` |
| フィールドタイプ | データの種類 | テキスト、段落、数値 |
| 必須 | 入力が必須か | はい/いいえ |
| 説明 | 入力ガイド | 「質問を入力」 |

---

## フィールドタイプの種類

1. **テキスト（Text）** - 短い1行の入力
2. **段落（Paragraph）** - 複数行の長文入力
3. **数値（Number）** - 数字のみの入力
4. **ファイル（File）** - ファイルのアップロード
5. **選択（Select）** - プルダウンからの選択

---

## 変数の使用方法

### ステップ1: 開始ノードで変数を定義

1. **開始ノード**をクリック
2. 「入力フィールドを追加」をクリック
3. フィールド名：`user_question`
4. フィールドタイプ：テキスト
5. 必須：はい

---

## 変数の使用方法

### ステップ2: プロンプトで変数を使用

```
あなたは何でも答えられるAIアシスタントです。

ユーザーからの質問：{{user_question}}

上記の質問に、分かりやすく丁寧に答えてください。
```

**ポイント：** `{{変数名}}` で変数を参照

---

## 複数の変数を使う例

**入力変数：**
- `topic`：話題（例：料理、旅行、スポーツ）
- `detail_level`：詳しさ（例：簡単、普通、詳しく）
- `target_audience`：対象者（例：小学生、大人）

**プロンプト：**
```
対象者：{{target_audience}}

{{topic}}について、{{detail_level}}説明してください。
```

---

## 条件分岐ノード

変数の値によって、異なる処理を実行

```
[開始ノード]
  ↓
[条件分岐ノード]
  ├─ 簡単 → [小学生向け説明]
  ├─ 普通 → [一般向け説明]
  └─ 専門的 → [専門家向け説明]
```

---

## ノード間での変数の受け渡し

```
[開始ノード]
  ↓ user_question
[LLMノード1] ← 質問に回答
  ↓ output（生成された回答）
[LLMノード2] ← {{LLMノード1.output}}を要約
  ↓
[終了ノード]
```

---

<!-- _class: lead -->

# 5. 実践：AIアシスタントを作る

---

## 演習1: 質問応答ボット

**目標：** ユーザーの質問に答えるボット

### 手順
1. ワークフロー作成：「質問応答ボット」
2. 開始ノードで変数 `question` を定義
3. LLMノードを追加（gemini-2.5-flash）
4. プロンプトを設定
5. テスト実行

---

## 演習1: プロンプト例

```
あなたは親切で知識豊富なAIアシスタントです。
ユーザーの質問に対して、
正確で分かりやすい回答を提供してください。

質問：{{question}}

回答：
```

---

## 演習2: レビュー感情分析ツール

**目標：** 商品レビューを
ポジティブ/ネガティブ/ニュートラルに分類

**入力変数：** `review_text`（レビュー文）

---

## 演習2: プロンプト例

```
あなたは商品レビューの分析専門家です。

以下の例を参考に、レビューを分類してください。

【例1】
レビュー：「素晴らしい商品です。買って良かった！」
分類：ポジティブ

【分類対象】
レビュー：{{review_text}}

以下の形式で回答してください：
分類：[ポジティブ/ネガティブ/ニュートラル]
理由：[簡潔に説明]
```

---

<!-- _class: lead -->

# 6. 構造化出力
（Structured Output）

---

## 構造化出力とは

AIの出力を決まった形式（JSON形式）で受け取る機能

プログラムで処理しやすいデータを作りたい場合に使う

---

## テキスト出力 vs 構造化出力

**普通のテキスト出力：**
```
ユーザー名: 山田太郎
年齢: 30
趣味: 読書、旅行
```
→ 人間には読みやすいが、プログラムで処理しにくい

**構造化出力（JSON）：**
```json
{
  "username": "山田太郎",
  "age": 30,
  "interests": ["読書", "旅行"]
}
```
→ プログラムで簡単に処理できる

---

## いつ使うのか

| 使用場面 | 説明 |
|---------|------|
| データベース保存 | ユーザー情報、商品情報などを保存 |
| API連携 | 他のシステムにデータを渡す |
| ワークフロー連携 | 次のノードで特定の値だけ使いたい |
| 複数の値を抽出 | 文章から名前、日付、金額などを抽出 |

---

## JSON Schemaとは

JSONデータの「型紙」のようなもの

どんなデータがどんな形で出てくるかを定義

---

## JSON Schemaの基本構造

```json
{
  "type": "object",
  "properties": {
    "フィールド名1": {
      "type": "データ型",
      "description": "説明"
    }
  },
  "required": ["必須フィールド名"]
}
```

---

## 主なデータ型

| データ型 | 説明 | 例 |
|---------|------|-----|
| string | 文字列 | `"こんにちは"` |
| number | 数値 | `30`, `3.14` |
| boolean | 真偽値 | `true`, `false` |
| array | 配列（リスト） | `["りんご", "バナナ"]` |
| object | オブジェクト（入れ子） | `{"name": "太郎"}` |

---

## 構造化出力の設定方法

### ステップ1: 対応モデルを選択

**主な対応モデル：**
- OpenAI GPT-4o / GPT-4o-mini
- Claude 4.5 Sonnet / Claude 4.5 Opus
- Google Gemini 2.5 Flash / Gemini 2.5 Pro

**注意：** 小型モデルでは失敗することがある

---

## 構造化出力の設定方法

### ステップ2: Response Formatを設定

1. LLMノードの設定パネルを開く
2. 「応答形式（Response Format）」を
   **JSON Schema**に変更
3. JSON Schemaエディターが表示される

---

## 構造化出力の設定方法

### ステップ3: JSON Schemaを定義

```json
{
  "type": "object",
  "properties": {
    "username": {
      "type": "string",
      "description": "ユーザーの名前"
    },
    "age": {
      "type": "number",
      "description": "ユーザーの年齢"
    }
  },
  "required": ["username", "age"]
}
```

---

<!-- _class: lead -->

# よくある質問（FAQ）

---

## Q1: プロンプトが長すぎると問題？

**A:** 長すぎるプロンプトの問題：
- コストが高くなる
- 処理が遅くなる
- AIが重要な指示を見落とすことがある

**推奨：** 必要な情報に絞り、簡潔に書く

---

## Q2: Temperatureは何に設定すべき？

| タスク | 推奨値 |
|--------|--------|
| 事実確認、計算 | 0.0 - 0.3 |
| 一般的なQ&A | 0.5 - 0.7 |
| 創作、アイデア出し | 0.8 - 1.0 |

---

## Q3: AIの回答が期待と違う場合は？

以下を試してください：

1. プロンプトをより具体的にする
2. 例（Few-shot）を追加する
3. 出力形式を明示する
4. ステップバイステップで指示する

---

<!-- _class: lead -->

# まとめ

---

## この回で学んだこと

✅ **LLMノードの基本**
- ストリーミングとブロッキングの違い
- モデルの選び方
- パラメータ設定

✅ **プロンプトの書き方**
- 役割、タスク、制約条件、出力形式の指定
- Few-shot（例示）の活用

---

## この回で学んだこと（続き）

✅ **変数の使い方**
- `{{変数名}}` で動的なプロンプト作成
- 複数の変数を組み合わせる
- ノード間で結果を受け渡す

✅ **構造化出力（JSON Schema）**
- JSON形式でのデータ受け取り
- 実践的なユースケース

---

## 次のステップ

**第3回：ナレッジベースとRAG**
- 独自のドキュメントを使った回答生成
- PDFやWebサイトの情報を活用
- より正確で信頼性の高いAIアプリ

---

## 練習課題

以下のアプリケーションを自分で作ってみましょう：

1. **翻訳アシスタント**
2. **文章添削ツール**
3. **キャッチコピー生成**

---

<!-- _class: lead -->
<!-- _paginate: false -->

# お疲れ様でした！

分からないことがあれば、
コミュニティやサポートに質問してみましょう
# 第1回：Dify導入と環境構築

## 📋 概要

**所要時間:** 90分
**形式:** ハンズオン + 講義

### 学習目標

* Difyの概要を理解し、実際にワークスペースを作成して基本操作を体験する
* モデルプロバイダー（Gemini）を設定して、独自のLLM環境を構築する
* 簡単なチャットボットを作成し、Difyの基本機能を体験する

### DoD（Definition of Done）

- [ ] Difyにログイン済み
- [ ] 新しいワークスペースを作成済み
- [ ] GeminiのAPIキー設定を完了し、モデルが選択可能である
- [ ] サンプルLLMワークフローを実行して応答を確認できる

---

## 🎯 第1回の構成（90分）

### 1. 導入・目的説明（10分）

#### 1.1 セミナー全体の概要

このセミナーシリーズでは、生成AIアプリケーション開発プラットフォーム「Dify」を使って、以下のようなスキルを習得します：

* **第1回（本日）:** Dify環境構築とモデルプロバイダー設定
* **第2回:** LLMノードとプロンプト設計
* **第3回:** Knowledge（RAG）とドキュメント連携
* **第4回:** エージェントと外部API連携
* **第5回:** デプロイと成果発表

#### 1.2 Difyとは

**Dify（ディファイ）** は、プログラミングの知識がなくても、誰でも簡単に「自分だけのAIアプリ」を作ることができるプラットフォームです。

**例えば、こんなことができます（活用例）:**
* 📄 **社内文書検索ボット**: 社内マニュアルやPDFを読み込ませて、質問に即座に答えてくれるAIを作る
* 📝 **ブログ記事作成ツール**: テーマを入力するだけで、構成案から記事執筆まで自動で行うAIを作る
* 🌍 **多言語翻訳アシスタント**: 専門用語を含んだ正確な翻訳を行うAIを作る

**Difyを使うメリット:**
* **プログラミング不要（ノーコード）**: 画面上のブロックを繋ぐだけで、直感的にアプリが作れます。エンジニアでなくてもアイデアを形にできます。
* **最新AIが選べる**: Google GeminiやChatGPTなど、世界中の最新AIモデルを自由に切り替えて使えます。
* **あなただけの知識（RAG）**: 手持ちの資料をAIに学習させて、一般的なAIには答えられない、あなた専用の賢いアシスタントに育てられます。

**公式リソース:**
* [Dify公式サイト](https://dify.ai)
* [Dify公式ドキュメント](https://docs.dify.ai)
* [GitHubリポジトリ](https://github.com/langgenius/dify)

#### 1.3 本日のゴール

本日の終了時点で、皆さんは以下ができるようになります：

1. Difyアカウントを作成し、ワークスペースを管理できる
2. Google GeminiのAPIキーを設定し、LLMモデルを使用できる
3. 簡単なチャットボットを作成し、プロンプトを設計できる

---

### 2. Dify概要とUI説明（20分）

#### 2.1 Difyの主要機能

Difyは以下の4つの主要機能で構成されています：

##### 📱 アプリケーション（Applications）

Difyで作成できる主なアプリケーションタイプ：

1. **Chatbot（チャットボット）**
   * 対話型のAIアプリケーション（例：カスタマーサポート、社内QAボット）
   * **Basic**: シンプルな対話設定
   * **Chatflow**: フローチャートで複雑な対話ロジックを構築

2. **Agent（エージェント）**
   * AIが自分で考えて道具（ツール）を使うタイプ（例：Web検索して旅行プランを立てるAI）
   * 目標達成のために自律的に行動します

3. **Workflow（ワークフロー）**
   * 一連の作業を自動化するタイプ（例：日報を読み込んで要約し、Slackに通知する）
   * 定型業務の自動化に最適

4. **Text Generator（テキスト生成）**
   * 文章作成に特化したタイプ（例：メールの返信作成、翻訳、要約）
   * 入力に対して一度だけ回答を生成します

##### 📚 Knowledge（ナレッジベース）

* ドキュメントをアップロードして検索可能な知識ベースを構築
* PDFファイル、Markdown、テキストなど様々な形式をサポート
* RAG（Retrieval-Augmented Generation）によって、ドキュメントの内容を基に正確な回答を生成

##### 🔧 Tools（ツール）

* 外部APIやサービスとの連携機能
* HTTPリクエスト、Google Sheets、データベースアクセスなど
* カスタムツールの作成も可能

##### 🤖 Models（モデルプロバイダー）

* 様々なLLMプロバイダーを統合管理
* OpenAI、Anthropic、Google Gemini、Azure OpenAI、ローカルモデルなど
* モデルごとにAPIキーを設定して使用

#### 2.2 Difyのインターフェース構成

Difyの画面は主に以下のセクションで構成されています：

```
┌─────────────────────────────────────────────────────┐
│  Studio（スタジオ）                                     │
│  - アプリケーションの作成・編集画面                         │
│  - ワークフローエディタ                                   │
│  - プロンプトエディタ                                     │
│  - デバッグ・プレビューパネル                              │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  Knowledge（ナレッジ）                                  │
│  - ドキュメントのアップロード・管理                         │
│  - ベクトルデータベースの設定                              │
│  - 検索設定                                            │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  Tools（ツール）                                       │
│  - 利用可能なツールの一覧                                │
│  - カスタムツールの追加                                   │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  Settings（設定）                                      │
│  - モデルプロバイダーの設定                              │
│  - ワークスペース管理                                    │
│  - メンバー管理                                         │
└─────────────────────────────────────────────────────┘
```

---

### 3. ハンズオン：環境構築とモデル設定（45分）

#### 3.1 Difyアカウント作成（10分）

##### ステップ1: Difyクラウドへのアクセス

1. ブラウザで [https://cloud.dify.ai](https://cloud.dify.ai) にアクセス
2. **「Sign Up」**（サインアップ）ボタンをクリック

##### ステップ2: アカウント登録

以下のいずれかの方法で登録できます：

* **Googleアカウント** でサインアップ（推奨）
* **GitHubアカウント** でサインアップ
* **メールアドレス** で登録

> **💡 ヒント:** Googleアカウントでのサインアップが最も簡単です

##### ステップ3: ワークスペースの作成

1. サインアップ後、自動的にワークスペース作成画面が表示されます
2. **ワークスペース名** を入力（例: 「My AI Workspace」）
3. **「Create」** をクリック

> **📝 注意:** ワークスペースは後から設定で変更・追加できます

#### 3.2 Google Gemini APIキーの取得（10分）

Difyで使用するLLMモデルとして、Google Geminiを設定します。

##### ステップ1: Google AI Studioへのアクセス

1. ブラウザで [https://aistudio.google.com](https://aistudio.google.com) にアクセス
2. Googleアカウントでログイン

##### ステップ2: APIキーの作成

1. 左側のメニューから **「Get API key」** をクリック
2. **「Create API key」** ボタンをクリック
3. プロジェクトを選択（または新規作成）
4. APIキーが生成されるので、**コピー**して安全な場所に保存

> **⚠️ 重要:** APIキーは他人に共有しないでください。流出すると不正利用される可能性があります。

##### ステップ3: 利用規約の確認

* Google Gemini APIの無料枠を確認
* 通常、月間一定のリクエスト数まで無料で利用可能
* 詳細は [Google AI 価格ページ](https://ai.google.dev/pricing) を参照

#### 3.3 DifyでGeminiモデルプロバイダーを設定（10分）

##### ステップ1: 設定画面へ移動

1. Difyダッシュボード右上の **ユーザーアイコン** をクリック
2. **「Settings」**（設定）を選択
3. 左側メニューから **「Model Provider」**（モデルプロバイダー）を選択

##### ステップ2: Geminiプロバイダーの追加

1. モデルプロバイダー一覧から **「Google Gemini」** を探す
2. **「Add Model」** または **「Configure」** をクリック
3. 以下の情報を入力：

   * **API Key:** 先ほど取得したGemini APIキーを貼り付け
   * **Model Name:** デフォルトのままでOK（例: `gemini-2.5-flash`）

4. **「Save」** または **「Validate」** をクリックして設定を保存

##### ステップ3: 設定の確認

* 設定が成功すると、Google Geminiプロバイダーが「有効」状態になります
* 利用可能なモデルの一覧が表示されます：
  * `gemini-3-pro` - 最先端の高性能モデル
  * `gemini-2.5-flash` - 高速・低コストでバランスの良いモデル
  * その他

> **💡 ヒント:** 初めての場合は `gemini-2.5-flash` を推奨します（高速で無料枠が広い）

#### 3.4 初めてのチャットボットを作成（15分）

##### ステップ1: 新しいアプリケーションを作成

1. 左側メニューから **「Studio」** を選択
2. **「Create Application」**（アプリケーション作成）ボタンをクリック
3. **「Chatbot」** を選択
4. 以下の情報を入力：

   * **Application Name:** 「My First Chatbot」
   * **Description:** 「初めてのDifyチャットボット」
   * **Icon:** お好みのアイコンを選択

5. **「Create」** をクリック

##### ステップ2: LLMモデルの設定

アプリケーション作成後、自動的にStudio画面が開きます。

1. LLMブロックを選択し、LLMモデルの設定画面を開く
2. プロバイダー: **「Google Gemini」** を選択
3. モデル: **「gemini-2.5-flash」** を選択
4. 以下のパラメータを設定：

   * **Temperature（温度）:** 0.7（創造性と一貫性のバランス）
   * **Max Tokens:** 1024（生成する最大トークン数）
   * **Top P:** 0.9
   * **Frequency Penalty:** 0
   * **Presence Penalty:** 0

> **📚 用語解説:**
> * **Temperature:** 応答のランダム性。高いほど創造的だが、一貫性が低下
> * **Max Tokens:** 生成するテキストの最大長
> * **Top P:** 出力の多様性を制御

##### ステップ3: プロンプトの設計

1. **「Prompt」** セクションを開く
2. 以下のシステムプロンプトを入力：

```
あなたは親切で知識豊富なAIアシスタントです。
ユーザーの質問に対して、分かりやすく丁寧に回答してください。
回答は簡潔でありながら、必要な情報を過不足なく提供してください。
```

3. **「Save」** をクリックしてプロンプトを保存

##### ステップ4: チャットボットのテスト

1. 右側の **「Preview」**（プレビュー）パネルを開く
2. 以下のような質問を入力して試してみましょう：

   **質問例1:**
   ```
   Difyとは何ですか？
   ```

   **質問例2:**
   ```
   生成AIを使ったアプリケーション開発のメリットを3つ教えてください
   ```

   **質問例3:**
   ```
   今日の日付を教えてください
   ```

3. 応答の質や速度を確認

##### ステップ5: 設定の調整（オプション）

応答の品質を向上させるため、以下を試してみてください：

1. **Opening Remarks（開始メッセージ）の設定:**
   * 「Features」セクションから「Opening Remarks」を有効化
   * 例: 「こんにちは！何かお手伝いできることはありますか？」

2. **Follow-up Suggestions（次の質問候補）の有効化:**
   * ユーザーが次に聞きたいことを提案

3. **Citation and Attribution（引用と帰属）の設定:**
   * Knowledge使用時に出典を明示（次回以降で使用）

##### ステップ6: アプリケーションの公開（オプション）

1. 右上の **「Publish」**（公開）ボタンをクリック
2. 公開リンクが生成されます
3. このリンクを共有することで、他の人もチャットボットを使用可能

> **💡 ヒント:** まだテスト段階なので、公開は次回以降でも構いません

---

### 4. 質疑応答と次回課題（15分）

#### 4.1 本日のまとめ

今日学んだこと：

✅ Difyの概要とアプリケーションタイプ
✅ Difyアカウントの作成とワークスペース管理
✅ Google Gemini APIキーの取得と設定
✅ 基本的なチャットボットの作成とテスト
✅ プロンプト設計の基礎

#### 4.2 よくある質問（FAQ）

**Q1: Difyは完全無料で使えますか？**

A: Difyクラウド版は無料プランがあります。ただし、使用するLLMモデル（Gemini、OpenAIなど）には各プロバイダーの料金が発生します。無料枠の範囲内で利用することも可能です。

**Q2: ローカルでDifyを動かすことはできますか？**

A: はい、可能です。DifyはオープンソースなのでDockerを使って自分のサーバーにデプロイできます。詳細は[公式ドキュメント](https://docs.dify.ai/getting-started/install-self-hosted)を参照してください。

**Q3: OpenAIのモデルは使えますか？**

A: はい、使えます。OpenAI、Anthropic Claude、Azure OpenAI、ローカルLLM（Ollama、LocalAIなど）など、多数のプロバイダーに対応しています。

**Q4: 日本語は正しく処理されますか？**

A: はい、Geminiをはじめ多くのLLMモデルは日本語を適切に処理できます。ただし、モデルによって精度に差があります。

**Q5: APIキーを間違えて入力してしまいました**

A: Settings > Model Providerから再度設定画面を開き、APIキーを修正できます。

#### 4.3 次回（第2回）の予告

次回は **「LLMノードとプロンプト設計」** を学びます：

* プロンプトエンジニアリングの基本
* モデルパラメータ（Temperature、Top Pなど）の詳細
* 条件分岐とテンプレート変数の使い方
* FAQボットの構築

**事前準備（任意）:**
* 本日作成したチャットボットで色々な質問を試してみる
* プロンプトを変更して応答の変化を観察する
* よくある質問（FAQ）のリストを考えてくる

#### 4.4 課題（任意）

余裕がある方は、以下を試してみてください：

1. **異なるモデルの比較**
   * `gemini-2.5-flash` と `gemini-3-pro` で同じ質問をして、応答の違いを比較

2. **Temperature設定の実験**
   * Temperatureを 0.1、0.7、1.5 と変えて、応答の変化を観察

3. **プロンプトの改良**
   * システムプロンプトを変更して、より専門的なアシスタント（例: 料理アシスタント、プログラミングヘルパーなど）を作成

---

## 📚 参考リソース

### 公式ドキュメント

* [Dify公式サイト](https://dify.ai)
* [Dify公式ドキュメント](https://docs.dify.ai)
* [Difyコミュニティ](https://discord.gg/dify)
* [GitHubリポジトリ](https://github.com/langgenius/dify)

### Google Gemini関連

* [Google AI Studio](https://aistudio.google.com)
* [Gemini API ドキュメント](https://ai.google.dev)
* [Gemini API 価格](https://ai.google.dev/pricing)

### 学習リソース

* [プロンプトエンジニアリングガイド](https://www.promptingguide.ai/jp)
* [OpenAI Cookbook（英語）](https://github.com/openai/openai-cookbook)

---

## 🎓 付録

### A. トラブルシューティング

#### A.1 APIキーが認証されない

**症状:** Gemini APIキー設定時に「Invalid API Key」エラーが表示される

**解決方法:**
1. APIキーが正しくコピーされているか確認（余分なスペースがないか）
2. Google AI StudioでAPIキーが有効化されているか確認
3. APIキーの使用制限がないか確認
4. 新しいAPIキーを再度生成して試す

#### A.2 チャットボットが応答しない

**症状:** プレビューパネルでメッセージを送信しても応答がない

**解決方法:**
1. モデルが正しく選択されているか確認
2. APIキーの設定が保存されているか確認
3. ブラウザのコンソールでエラーメッセージを確認（F12キーで開く）
4. ページをリロードしてもう一度試す

#### A.3 日本語が文字化けする

**症状:** 入力または出力の日本語が正しく表示されない

**解決方法:**
1. ブラウザの文字エンコーディング設定を確認（UTF-8になっているか）
2. プロンプトで明示的に「日本語で回答してください」と指定
3. 別のブラウザで試してみる

### B. ショートカットキー

Dify Studioで使える便利なショートカット：

* **Ctrl + S（Cmd + S）:** 変更を保存
* **Ctrl + Enter（Cmd + Enter）:** プレビューでメッセージ送信
* **Ctrl + /（Cmd + /）:** コマンドパレットを開く（一部の機能）

### C. 用語集

| 用語 | 説明 |
|------|------|
| **Workspace** | Difyでのプロジェクトや設定を管理する単位 |
| **Model Provider** | LLMモデルを提供するサービス（OpenAI、Geminiなど） |
| **Temperature** | 応答のランダム性を制御するパラメータ（0〜2） |
| **Token** | LLMが処理するテキストの最小単位 |
| **Prompt** | LLMに与える指示やコンテキスト |
| **RAG** | Retrieval-Augmented Generation（検索拡張生成） |
| **Knowledge Base** | ドキュメントから構築される検索可能な知識ベース |

---

## ✅ チェックリスト

本日の内容を完了したか確認しましょう：

- [ ] Difyアカウントを作成した
- [ ] ワークスペースを作成した
- [ ] Google Gemini APIキーを取得した
- [ ] DifyでGeminiプロバイダーを設定した
- [ ] 初めてのチャットボットを作成した
- [ ] プロンプトを設定してテストした
- [ ] 応答が正常に返ってくることを確認した

すべてチェックできたら、次回に進む準備ができています！

---

**お疲れさまでした！次回もよろしくお願いします。** 🎉
